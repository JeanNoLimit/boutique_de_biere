{% extends 'base.html.twig' %}

{% block title %}Vérification des informations{% endblock %}
{% block meta %}<meta name="robots" content="noindex, follow" >{% endblock %}
{% block body %}

{# Bouton retour panier #}

    <div class="action_back">
        <a href="{{path('cart_index')}}" class="button_base button_back"><i class="fa-solid fa-chevron-left"></i> Retour Panier</a>
    </div>
    
    <h1>Vérification des informations</h1>

    <h2>Récapitulatif de la commande</h2>

    {# ICI TABLEAU RECAPITULATIF COMMANDE (ne pouvant être modifié) #}
    <table style="min-width: 600px;margin:40px auto">
        {% for element in elements %}
   
            <tr>
                <th colspan="3" style="text-align: left;font-size:1.3rem;">{{ element.product.designation }} {{ element.product.volume|number_format }}cl - {{element.product.provider}}</th>
            </tr>
            <tr style="height:30px;">
                <td>
                    Quantité : {{element.quantity }}
                </td>
                <td>
                    Prix : {{ (element.product.price ?? 0 / 100) | number_format(2, ',', '.' ) }} €
                </td>
                <td>
                    Sous-Total : {{ (element.SsTotal ?? 0 / 100) | number_format(2, ',', '.' ) }} €
                </td>
            </tr>
            {% if element.product.stock <= 0 %}
                <tr>
                    <td colspan="3" style="font-size:0.7rem;color:red;font-style:italic;"> Rupture de stock : le délais de préparation de votre commande peut-être ralongé de quelques jours</td>
                </tr>
            {% elseif element.stockTemp < 0 %}
                <tr>
                    <td colspan="3" style="font-size:0.7rem;color:red;font-style:italic;"> Avertissement : La quantité commandé dépasse la quantité en stock, le délais de préparation de votre commande peut-être ralongé de quelques jours</td>
                </tr>
            {% endif %}

        {% endfor %}

        {% if cotisation is defined and cotisation is not empty %}
        {# COTISATION #}
        <tr>
            <td colspan="3" style="text-align: left;font-size:1.3rem;"><span style="font-weight: 600;">Cotisation annuelle valable jusqu'au {{cotisation.endDate |date("d/m/Y", "Europe/Paris") }}  </span> </td> 
        </tr>
            {% if cotisation.price > 0 %}
                <tr>
                    <td>Quantité : 1 </td>
                    <td>Prix : {{ (cotisation.price ?? 0 / 100) | number_format(2, ',', '.' ) }} €</td>
                    <td>Sous-Total : {{ (cotisation.price ?? 0 / 100) | number_format(2, ',', '.' ) }} €</td>
                </tr>
            {% endif %}
    {% endif %}
    </table>
{# br à supprimer #}
<br><br><br>

    <div class="total_commande" style="display: flex;justify-content: space-around;margin-bottom:40px;">
        <p> Nombre d'acticles : {{ cotisation.price == 0 ? elements|length : elements|length +1 }} </p>
        <p>Total : {{ (total ?? 0 / 100) | number_format(2, ',', '.' ) }} €</p>
    </div>

    <h2>Mes informations de facturation </h2>

    {# ICI LE FORMULAIRE UTILISATEUR #}
    <div class="formContainer">
        {{ form_errors(form) }}
        {{ form_start(form) }}
        
        <div class="row">
            {{ form_row(form.lastName) }}
        </div>
        <div class="row">
            {{ form_row(form.firstName) }}
        </div>
        <div class="row">
            {{ form_row(form.birthDate) }}
        </div>
        <div class="row">
            {{ form_row(form.adress) }}
        </div>
        <div class="row">
            {{ form_row(form.zipCode) }}
        </div>
        <div class="row">
            {{ form_row(form.city) }}
        </div>
        <div class="row">
            {{ form_row(form.tel) }}
        </div>
            
        
    </div>

    <div class="before_redirect">
        <p>Valider ma commande et passer au paiement.</p>
        <p>Vous allez être redirigé vers le service de paiement.</p>
    </div>

    {# VALIDATION ET PASSER AU PAIMENT #}

    <div class="step_validation">
        <button type="submit" class="btn_register button_base button_step_validation">payer <span style="font-weight:800;">{{ (total ?? 0 / 100) | number_format(2, ',', '.' ) }} €</span> par Stripe</button>
    </div>
    {{ form_end(form) }}

    {% include "_partial/_bandeau_boissons.html.twig" %}
    
{% endblock %}